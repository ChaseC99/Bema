<!DOCTYPE HTML>
<html>
    <head>
        <title>WIP Judging tool</title>
        <meta charset="utf-8">
        <!--<link rel="stylesheet" type="text/css" href="">-->
        <style>
            #entry-title {
              text-align: center;
            }
            #entry-viewer-iframe {
              border: none;
              width: 100%;
              min-height: 404px;
            }
            #entry-form {
              width: 30%;
              margin: 20px auto;
            }
            #submit-form-button {
              width: 100%;
              height: 30px;
              background: rgb(0, 155, 64);
              border-radius: 10px;
              color: white;
            }
            .form-field-div {
              margin-bottom: 15px;
            }
            .form-field-div label {
              display: block;
            }
            .form-input {
              padding-bottom: 20px;
              width: 100%;
            }
        </style>
    </head>
    <body>
        <h1 id="entry-title"></h1>
        <iframe id="entry-viewer-iframe"></iframe>
        <!-- add loading spinner -->

        <form id="entry-form">
            <div class="form-field-div">
                <label>Criteria 1</label>
                <input class="form-input" type="text" name="form_field_1" placeholder="Criteria 1"/>
            </div>

            <div class="form-field-div">
                <label>Criteria 2</label>
                <input class="form-input" type="text" name="form_field_2" placeholder="Criteria 2"/>
            </div>

            <div class="form-field-div">
                <label>Criteria 3</label>
                <input class="form-input" type="text" name="form_field_3" placeholder="Criteria 3"/>
            </div>

            <div class="form-field-div">
                <label>Criteria 4</label>
                <input class="form-input" type="text" name="form_field_4" placeholder="Criteria 4"/>
            </div>

            <button type="submit" id="submit-form-button">Submit</button>
        </form>
    </body>
    <script>

    /*
    1) Input ID of contest. *
    2) Load all spinoffs into `entries` array. *
    3) Display an entry, maybe pick in random order. *
    4) Entry's code on left, canvas on right. Maybe w embeds *
    5) Enter score below, submit.
    6) Store submission in another array,
       remove this entry from `entries` array.
    7) Pick another entry from `entries`, repeat.
    */

    // https://www.khanacademy.org/computer-programming/contest-gingerbread-house/5611465022767104
    var CONTEST_ID = 6312160950943744;
    var ENTRIES = [];
    var SUBMITTED = [];

    var title = document.getElementById('entry-title');
    var viewerIframe = document.getElementById('entry-viewer-iframe');

    // Push entry IDs into `ENTRIES_IDS`
    function storeEntries(data) {
        for (var i = 0; i < data.scratchpads.length; ++i) {
            ENTRIES.push({
              url: data.scratchpads[i].url,
              title: data.scratchpads[i].title
            });
        }
        // If all entries loaded...
        if (data.scratchpads.length === ENTRIES.length) {
            let randomEntry = ENTRIES[Math.floor(Math.random() * ENTRIES.length)];
            console.log(Math.floor(Math.random() * ENTRIES.length))
            console.log(randomEntry);

            viewerIframe.setAttribute('src', `${randomEntry.url}/embedded`);
            title.textContent = randomEntry.title
        }
    };

    // Get spinoffs with API
    var s = document.createElement('script');
    s.setAttribute('src', 'https://www.khanacademy.org/api/internal/scratchpads/' + CONTEST_ID + '/top-forks?callback=storeEntries&projection={"scratchpads":[{"url":1,"title":1}]}&\x5f=' + Date.now());
    document.body.appendChild(s);
    </script>
</html>
